

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>** &mdash; Gemini Documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Wiki Tests" href="../wiki/wiki-index.html" />
    <link rel="prev" title="PDF Tests" href="pdfs-index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Gemini Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Community Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://epics-controls.org">EPICS Website</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.epics-controls.org">EPICS Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Start Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-start/quick-start.html">Quick Start Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">PDFs:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="pdfs-index.html">PDF Tests</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Gemini Application Developers Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acronyms-and-abbreviations">Acronyms and Abbreviations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gemini-real-time-system-software-environment">Gemini Real Time System Software Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ade-overview-and-definitions">ADE Overview and Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ade-directory-structure">ADE Directory Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#epics-ioc-types">EPICS IOC Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ioc-naming">IOC Naming</a></li>
<li class="toctree-l4"><a class="reference internal" href="#epics-releases">EPICS Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#categories-of-built-software">Categories of Built Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vendor-software">Vendor Software</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-dependencies">Software Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#host-and-target-architecture-builds">Host and Target Architecture Builds</a></li>
<li class="toctree-l4"><a class="reference internal" href="#local-configuration-data">Local Configuration Data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#software-development-process">Software Development process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#major-redevelopment">Major Redevelopment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bug-fix-to-released-code">Bug Fix to Released Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#development-examples">Development Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-new-support-module-install-in-work-area">Create new support module: install in work Area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-new-ioc-module-install-in-work-area">Create new IOC module: install in work Area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modify-existing-modules-installed-in-the-work-area">Modify existing Modules installed in the work area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#release-support-module-to-prod-area">Release support module to prod area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#release-ioc-module-to-prod-area">Release IOC module to prod area</a></li>
<li class="toctree-l4"><a class="reference internal" href="#feature-branch-major-redevelopment">Feature Branch : Major Redevelopment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bugfix-branch-bug-fix-to-released-code">Bugfix Branch: Bug Fix to Released Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#booting-iocs">Booting IOCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boot-redirector">Boot Redirector</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-ioc-boot-configuration-script">configure-ioc boot configuration script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#booting-mvme6100-rtems-ioc">Booting MVME6100 RTEMS IOC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#booting-mvme2700-rtems-ioc">Booting MVME2700 RTEMS IOC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ade-directory-structure-1">ADE Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ade-profile-and-environment-variables">ADE profile and Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-release-scripts-reference">Build &amp; Release Scripts Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gem-start-new-module-py">gem-start-new-module.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-checkout-module-py">gem-checkout-module.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-list-modules-py">gem-list-modules.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-changes-since-release-py">gem-changes-since-release.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-logs-since-release-py">gem-logs-since-release.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-release-py">gem-release.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-start-feature-branch-py">gem-start-feature-branch.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-start-bugfix-branch-py">gem-start-bugfix-branch.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-sync-from-trunk-py">gem-sync-from-trunk.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-list-branches-py">gem-list-branches.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-vendor-import-py">gem-vendor-import.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-vendor-update-py">gem-vendor-update.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gem-get-vendor-current-py">gem-get-vendor-current.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Wiki Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../wiki/wiki-index.html">Wiki Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">HTML Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../html/html-index.html">Html Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/other-index.html">Other Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code/code-index.html">Code Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Gemini HowTo's:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howtos/RTEMSInstall.html">Installing RTEMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/EPICSInstall.html">Installing EPICS Base on the ADE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/ADEInstall.html">Installing ADE Build Tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Gemini Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="pdfs-index.html">PDF Tests</a> &raquo;</li>
        
      <li>**</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/pdfs/ade.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><a class="reference internal" href="../_images/image1.jpeg"><img alt="image0" src="../_images/image1.jpeg" style="width: 1.47917in; height: 1.27917in;" /></a><a class="reference internal" href="../_images/image2.jpeg"><img alt="image1" src="../_images/image2.jpeg" style="width: 0.95625in; height: 1.33819in;" /></a></p>
<p><strong>Gemini Application</strong></p>
<p><strong>Development Environment</strong></p>
<p><strong>User Manual</strong></p>
<p>Issue 1.0</p>
<p>December 30, 2014</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 64%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Author:</p></td>
<td><p>Philip Taylor, Observatory Sciences Ltd</p></td>
<td><p><a class="reference internal" href="../_images/image3.png"><img alt="pbt_signature" src="../_images/image3.png" style="width: 2.11042in; height: 0.66181in;" /></a></p></td>
</tr>
</tbody>
</table>
<p>Observatory Sciences Ltd</p>
<p>William James House</p>
<p>Cambridge. CB4 0WX.</p>
<p>United Kingdom.</p>
<div class="section" id="id3">
<h1><a href="#id1"><span class="problematic" id="id2">**</span></a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p><strong>Revision History</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 24%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Revision
Number</p></th>
<th class="head"><p>Authors</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Reason for
Issue /
Description of
Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.0</p></td>
<td><p>Philip Taylor</p></td>
<td><p>30 December
2014</p></td>
<td><p>Initial
Release</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>**
Table of Contents**</p>
<p><a class="reference external" href="#introduction">1 Introduction 5</a></p>
<p><a class="reference external" href="#purpose">1.1 Purpose 5</a></p>
<p><a class="reference external" href="#acronyms-and-abbreviations">1.2 Acronyms and Abbreviations 5</a></p>
<p><a class="reference external" href="#references">1.3 References 5</a></p>
<p><a class="reference external" href="#document-overview">1.4 Document Overview 5</a></p>
<p><a class="reference external" href="#gemini-real-time-system-software-environment">2 Gemini Real Time System Software Environment
6</a></p>
<p><a class="reference external" href="#ade-overview-and-definitions">3 ADE Overview and Definitions 6</a></p>
<p><a class="reference external" href="#_Toc409109220">3.1 ADE Directory Structure 7</a></p>
<p><a class="reference external" href="#epics-ioc-types">3.2 EPICS IOC Types 8</a></p>
<p><a class="reference external" href="#ioc-naming">3.3 IOC Naming 8</a></p>
<p><a class="reference external" href="#epics-releases">3.4 EPICS Releases 9</a></p>
<p><a class="reference external" href="#categories-of-built-software">3.5 Categories of Built Software 9</a></p>
<p><a class="reference external" href="#vendor-software">3.6 Vendor Software 10</a></p>
<p><a class="reference external" href="#software-dependencies">3.7 Software Dependencies 10</a></p>
<p><a class="reference external" href="#_Toc409109227">3.8 Host and Target Architecture Builds 11</a></p>
<p><a class="reference external" href="#local-configuration-data">3.9 Local Configuration Data 12</a></p>
<p><a class="reference external" href="#software-development-process">4 Software Development process 13</a></p>
<p><a class="reference external" href="#normal-module-development">4.1 Normal Module Development 14</a></p>
<p><a class="reference external" href="#major-redevelopment">4.2 Major Redevelopment 15</a></p>
<p><a class="reference external" href="#bug-fix-to-released-code">4.3 Bug Fix to Released Code 15</a></p>
<p><a class="reference external" href="#development-examples">5 Development Examples 16</a></p>
<p><a class="reference external" href="#create-new-support-module-install-in-work-area">5.1 Create new support module: install in work Area
16</a></p>
<p><a class="reference external" href="#create-new-ioc-module-install-in-work-area">5.2 Create new IOC module: install in work Area
17</a></p>
<p><a class="reference external" href="#modify-existing-modules-installed-in-the-work-area">5.3 Modify existing Modules installed in the work area
18</a></p>
<p><a class="reference external" href="#release-support-module-to-prod-area">5.4 Release support module to prod area
18</a></p>
<p><a class="reference external" href="#release-ioc-module-to-prod-area">5.5 Release IOC module to prod area
19</a></p>
<p><a class="reference external" href="#feature-branch-major-redevelopment">5.6 Feature Branch : Major Redevelopment
19</a></p>
<p><a class="reference external" href="#bugfix-branch-bug-fix-to-released-code">5.7 Bugfix Branch: Bug Fix to Released Code
20</a></p>
<p><a class="reference external" href="#_Toc409109241">6 Booting IOCs 21</a></p>
<p><a class="reference external" href="#configure-ioc-boot-configuration-script">6.1 configure-ioc boot configuration script
21</a></p>
<p><a class="reference external" href="#booting-mvme6100-rtems-ioc">6.2 Booting MVME6100 RTEMS IOC 22</a></p>
<p><a class="reference external" href="#booting-mvme2700-rtems-ioc">6.3 Booting MVME2700 RTEMS IOC 23</a></p>
<p><a class="reference external" href="#ade-directory-structure-1">7 ADE Directory Structure 24</a></p>
<p><a class="reference external" href="#work-directory">7.1 work Directory 25</a></p>
<p><a class="reference external" href="#production-prod-directory">7.2 Production (“prod”) Directory 30</a></p>
<p><a class="reference external" href="#ade-profile-and-environment-variables">8 ADE profile and Environment Variables
32</a></p>
<p><a class="reference external" href="#build-release-scripts-reference">9 Build &amp; Release Scripts Reference
33</a></p>
<p><a class="reference external" href="#gem-start-new-module.py">9.1 gem-start-new-module.py 33</a></p>
<p><a class="reference external" href="#gem-checkout-module.py">9.2 gem-checkout-module.py 34</a></p>
<p><a class="reference external" href="#gem-list-modules.py">9.3 gem-list-modules.py 35</a></p>
<p><a class="reference external" href="#gem-changes-since-release.py">9.4 gem-changes-since-release.py 35</a></p>
<p><a class="reference external" href="#gem-logs-since-release.py">9.5 gem-logs-since-release.py 36</a></p>
<p><a class="reference external" href="#gem-release.py">9.6 gem-release.py 37</a></p>
<p><a class="reference external" href="#gem-start-feature-branch.py">9.7 gem-start-feature-branch.py 38</a></p>
<p><a class="reference external" href="#gem-start-bugfix-branch.py">9.8 gem-start-bugfix-branch.py 39</a></p>
<p><a class="reference external" href="#gem-sync-from-trunk.py">9.9 gem-sync-from-trunk.py 39</a></p>
<p><a class="reference external" href="#gem-list-branches.py">9.10 gem-list-branches.py 40</a></p>
<p><a class="reference external" href="#gem-vendor-import.py">9.11 gem-vendor-import.py 40</a></p>
<p><a class="reference external" href="#gem-vendor-update.py">9.12 gem-vendor-update.py 41</a></p>
<p><a class="reference external" href="#gem-get-vendor-current.py">9.13 gem-get-vendor-current.py 42</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<p>This document provides a User Manual for the application development
environment (ADE) which supports the Gemini Real-Time System software
development process. For a detailed description, see reference [RD1].</p>
<p>Note that this document describes only the application development
environment for the Gemini Real-Time systems. The development of Gemini
instrument software is outside its scope.</p>
</div>
<div class="section" id="acronyms-and-abbreviations">
<h3>Acronyms and Abbreviations<a class="headerlink" href="#acronyms-and-abbreviations" title="Permalink to this headline">¶</a></h3>
<p>This section gathers together some of the relevant acronyms and
abbreviations used in this document</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ADE</p></th>
<th class="head"><p>Application Development Environment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EPICS</p></td>
<td><p>Experimental Physics and Industrial Control System</p></td>
</tr>
<tr class="row-odd"><td><p>GUI</p></td>
<td><p>Graphical User Interface</p></td>
</tr>
<tr class="row-even"><td><p>IOC</p></td>
<td><p>EPICS Input/Output Controller</p></td>
</tr>
<tr class="row-odd"><td><p>NFS</p></td>
<td><p>Network File System</p></td>
</tr>
<tr class="row-even"><td><p>OPI</p></td>
<td><p>Operators Interface (EPICS)</p></td>
</tr>
<tr class="row-odd"><td><p>SVN</p></td>
<td><p>Subversion (version control system)</p></td>
</tr>
<tr class="row-even"><td><p>TBC</p></td>
<td><p>To Be Confirmed</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p><em>[RD1] Gemini Application Development Environment &amp; Software Product
Control/Release Procedures. Philip Taylor (Observatory Sciences Ltd).
Version 1.0, dated 16 October 2014.</em></p>
<blockquote>
<div><p>Document Overview</p>
</div></blockquote>
<hr class="docutils" />
<p>This User Manual describes most of the features of the Gemini
Application Development Environment (ADE). Often there will be more
information here than you need for your purpose. A quick summary of the
contents follows, which should provide pointers for specific purposes.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><strong>How do I use the Gemini ADE for software development?</strong> If you are</dt><dd><p>familiar with the basic concepts behind the ADE, Chapter 5 as well
as Chapter 4 provides examples and background on the normal
development procedures when using the ADE.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>What is the Gemini ADE?</strong> Chapter 2 defines the ADE software and</dt><dd><p>supported hardware; Chapter 3 provides information about the
concepts and terminology used in the ADE.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>How do boot my EPICS IOC?</strong> Chapter 6 describes how the ADE allows</dt><dd><p>configuration of where an IOC boots from, as well as IOC boot
parameters.</p>
</dd>
</dl>
</li>
<li><p><strong>Details of ADE directories, environment and scripts.</strong> Reference
details are provided in Chapter 7 (ADE directory structure), Chapter
8 (environment) and Chapter 9 (ADE Python scripts).</p></li>
</ol>
</div>
</div>
<div class="section" id="gemini-real-time-system-software-environment">
<h2>Gemini Real Time System Software Environment<a class="headerlink" href="#gemini-real-time-system-software-environment" title="Permalink to this headline">¶</a></h2>
<p>The Gemini Application Development Environment (ADE) comprises software
and tools as follows:</p>
<ol class="arabic simple">
<li><p><strong>Development Workstation and EPICS Soft IOC platform</strong>: 64 bit x86
instruction set (x86_64 architecture) PC running CentOS Linux
operating system, version 6.5.</p></li>
</ol>
<blockquote>
<div><p>CentOS Linux is a free distribution of Red Hat Enterprise Linux
(RHEL), excluding Red Hat proprietary software and licensing
restrictions.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>RTEMS 4.10 operating system</strong> software, comprising the OS kernel
and tools for cross-development of applications running under RTEMS,
including a cross-compiler with support for the beatnik RTEMS BSP for
the MVME6100 VME board and BSP support for the MVME2700 VME board
(currently using the RTEMS standard mvme2307 BSP). The RTEMS “addon”
and BSP extension packages must have been built and installed for the
supported target boards.</p></li>
</ol>
<blockquote>
<div><p>The RTEMS software is installed in $GEM_ROOT/targetOS/RTEMS.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>EPICS R3.14.12.4 Base</strong> software, installed in the directory
pointed to by the environment variable $EPICS. It should have been
built to support the host (linux-x86_64) architecture as well as the
cross-compiled target architectures (RTEMS-beatnik and
RTEMS-mvme2307).</p></li>
</ol>
<blockquote>
<div><p>The EPICS software is installed in $GEM_ROOT/epics/R3.14.12.4.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Appropriate <strong>EPICS extensions</strong>, compatible with the Base EPICS
installation, including but not confined to: TDCT v2.13.19 (or
later), msi and EDM. These will be installed in the directory pointed
to by the environment variable $EPICS_EXTENSIONS.</p></li>
<li><p>Gemini ADE specific scripts and EPICS configuration files.</p></li>
<li><p><strong>Display Tools:</strong> <em>GUI development is outside the scope of the ADE.</em></p></li>
<li><p><strong>Configuration Management Tool:</strong> Subversion (SVN). Version 1.6.11
is currently used.</p></li>
</ol>
</div>
<div class="section" id="ade-overview-and-definitions">
<h2>ADE Overview and Definitions<a class="headerlink" href="#ade-overview-and-definitions" title="Permalink to this headline">¶</a></h2>
<p>The Application Development Environment to support the Gemini Real-Time
System software development process consists of</p>
<ul class="simple">
<li><dl class="simple">
<dt>A comprehensive directory structure which is maintained in a file</dt><dd><p>system accessible to all developers and operational systems. This
defines standard locations in which different types of software
modules can be built and accessed using automated builds and
scripts.</p>
</dd>
</dl>
</li>
<li><p>The directory structure defines locations which reflect the following
software characteristics:</p>
<ul>
<li><p>Module type, based on its functionality. A software module is
defined to be either a <em>Support Module</em> or an <em>IOC Application</em>.</p></li>
<li><p>Maturity. Built software is categorized as being either <em>Work</em>
software or <em>Production</em> software depending on how stable and
reliable it is considered, usually based on the level of testing
that has been performed. Software is designated as Production
software when it is released, following testing.</p></li>
</ul>
</li>
<li><p>A complete set of built software is kept up-to-date, with the
software installed in standard locations, using an automated build
server. Multiple versions of production software modules are
maintained. This released (production area) software is protected
with read-only access.</p></li>
<li><p>A source code control system, based on Subversion (SVN), along with a
set of Python scripts that work with Subversion to standardize the
processes in the software development cycle.</p></li>
<li><p>A Build system based on GNU Make (hereafter referred to as “Make” in
this document). The standard EPICS Build conventions are adopted,
with enhancements including new Make rules, additional templates,
macros, configuration files and consistency checking features.</p></li>
<li><p>IOC naming conventions and standard startup scripts which enable
EPICS IOCs to be booted with any specified version of software,
supported by associated scripts and files to enable easy changing of
the IOC boot configuration.</p></li>
</ul>
<p>Some additional features are:</p>
<ol class="arabic simple">
<li><p>Only source code, not built code, is stored in the Subversion
repository.</p></li>
<li><p>Software is never copied directly from one area to another (i.e. from
home to live testing or from the test area to production) – it is
always moved to a new area via a commit and checkout from the
Subversion repository. Commit and checkout are performed by
Subversion scripts which have been written especially to support this
process. This ensures that what is tested is reproducible from the
repository.</p></li>
<li><p>Any software production release is tagged in the repository so it can
be recovered directly from the tag.</p></li>
<li><p>No changes are required to source code to build and run it in any of
the checked out locations.</p></li>
<li><p>In some cases of externally supplied software trees (e.g. EPICS and
RTEMS), there is no process of moving from test to release version. A
new version of EPICS might be tested and then declared to be the
production version. New local application development is then done
using the new EPICS tree.</p></li>
</ol>
<div class="section" id="ade-directory-structure">
<h3>ADE Directory Structure<a class="headerlink" href="#ade-directory-structure" title="Permalink to this headline">¶</a></h3>
<p>One of the most important features of the Gemini ADE is a well-defined
directory structure for both source and executable files which reflects
software dependencies, type and maturity. The ADE has a root directory,
in this document this is <strong>/gem_sw</strong> (shown as $ROOT below).</p>
<p>An ADE software module directory name has the following structure in the
Gemini ADE:</p>
<p>$ROOT/&lt;maturity&gt;/&lt;EPICSversion&gt;/&lt;module_type&gt;/&lt;module_name&gt;</p>
<p>Subsequent sections provide a detailed description of the meaning of the
module top-level name components. Below this level, software modules
have a directory structure defined by the default EPICS build/release
environment.</p>
<p>A few examples will provide an overview of these features:</p>
<ol class="arabic simple">
<li><p>/<strong>gem_sw/work/R3.14.12.4/support/slalib</strong></p></li>
</ol>
<p>This software module is not yet released into production use and so it
is in the work area of the ADE directory tree. It is the top-level
directory of a support software module called slalib. It will be built
using the files and libraries provided by EPICS release R3.14.12.4.</p>
<ol class="arabic simple" start="2">
<li><p><strong>/gem_sw/prod/R3.14.12.4/support/timelib/1-8-6</strong></p></li>
</ol>
<p>This software module has been released into production use as version
1-8-6 and so it is in the prod area of the ADE directory tree. It is the
top-level directory of a support software module called timelib. It has
been built using the files and libraries provided by EPICS release
R3.14.12.4.</p>
<ol class="arabic simple" start="3">
<li><p>/<strong>gem_sw/work/R3.14.12.4/ioc/GEMTEST/MK</strong></p></li>
</ol>
<p>This software module is not yet released into production use and so it
is in the work area of the ADE directory tree. It is the top-level
directory of an IOC software module with the IOC named as GEMTEST and
the IOC location MK (Gemini North). It will be built using the files and
libraries provided by EPICS release R3.14.12.4.</p>
<ol class="arabic simple" start="4">
<li><p>/<strong>gem_sw/prod/R3.14.12.4/ioc/GEMTEST/CP/1-1</strong></p></li>
</ol>
<p>This software module has been released into production use as version
1-1 and so it is in the prod area of the ADE directory tree. It is the
top-level directory of an IOC software module with the IOC named as
GEMTEST and the IOC location CP (Gemini South). It will be built using
the files and libraries provided by EPICS release R3.14.12.4.</p>
</div>
<div class="section" id="epics-ioc-types">
<h3>EPICS IOC Types<a class="headerlink" href="#epics-ioc-types" title="Permalink to this headline">¶</a></h3>
<p>The ADE is designed to build and install software for all types of EPICS
IOCS, including RTEMS (hardware) IOCs as well as Soft Linux IOCs.</p>
<p>A Soft IOC is an EPICS IOC running on a non-embedded Linux host. There
may be more than one Soft IOC per Linux host. Normally it does not
depend on any hardware on the host with the exception of standard
communications interfaces such as Ethernet.</p>
</div>
<div class="section" id="ioc-naming">
<h3>IOC Naming<a class="headerlink" href="#ioc-naming" title="Permalink to this headline">¶</a></h3>
<p>The operation of the ADE depends on a consistent naming scheme being
adopted for all operational IOCs. The host name of the IOC must be set
correctly to enable it to automatically locate and access the scripts
and application software for use with the IOC.</p>
<p>Gemini IOCs have names of the form</p>
<blockquote>
<div><p>&lt;system&gt;-&lt;location&gt;-IOC<em>-&lt;number&gt;</em></p>
</div></blockquote>
<p>Where</p>
<p>system : (string) The name of the software subsystem run on this IOC,
usually the hardware that is being controlled. For example, the string
AG would be used to denote the IOC controlling the Gemini A&amp;G.</p>
<p>location: (string) The physical location of the IOC. For Gemini, this is
either MK or CP, denoting Gemini North or South.</p>
<p><em>number</em>: Optional (2 digit integer) number identifying the IOC in a set
of multiple IOCs associated with this subsystem at this location. <em>At
Gemini there will usually be only a single instance of an IOC
controlling a particular piece of hardware at a given location, and so
in most cases, this value will be omitted.</em></p>
<p>A complete Gemini IOC name might therefore be: AG-MK-IOC, meaning the
IOC running the A&amp;G control software at Gemini North (MK).</p>
<p>The ADE includes automatic building of IOC startup scripts from a script
“source file” which provides for substitutions of location and host
specific strings. The startup script for an IOC is accessed via a single
line redirection script at a fixed location. The executable file to run
the IOC is accessed via a soft link with a name fixed for that IOC (see
section 6).</p>
</div>
<div class="section" id="epics-releases">
<h3>EPICS Releases<a class="headerlink" href="#epics-releases" title="Permalink to this headline">¶</a></h3>
<p>Ideally, only a single EPICS release would be in use with the Gemini ADE
at one time. In reality, especially during periods of upgrading,
multiple EPICS releases must be supported simultaneously.</p>
<p>The file structure of the ADE defines a dependency on the EPICS version
used when building the software. A new branch of the ADE tree is created
for each EPICS version. The ADE directory structure supports these
dependencies by having the name of the EPICS release at a high-level in
the hierarchy. All work or production release versions are therefore
specific to the EPICS release with which they were built.</p>
<p>The EPICS release supported with the initial implementation of the
Gemini ADE is the latest stable version: R3.14.12.4 (released on 16
December 2013).</p>
</div>
<div class="section" id="categories-of-built-software">
<h3>Categories of Built Software<a class="headerlink" href="#categories-of-built-software" title="Permalink to this headline">¶</a></h3>
<p>Software releases are categorized in a way which is reflected in the
standard ADE directory structure. They are categorized in two ways:</p>
<ol class="arabic simple">
<li><p>The type of software module. This can be either a <em>Support Module</em> or
an <em>IOC Application</em>.</p></li>
<li><p>Categorized according to the degree of maturity of the released
software, which depends on how well it has been tested and when and
where it should be used. There are two categories of released
software: <em>Work</em> and <em>Prod</em>(<em>uction</em>).</p></li>
</ol>
<div class="section" id="software-module-type">
<h4>Software Module Type<a class="headerlink" href="#software-module-type" title="Permalink to this headline">¶</a></h4>
<p>The following two types of software module are supported by the ADE</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><strong>Support Module</strong>. This is a self-contained EPICS software module</dt><dd><p>which is intended to be used by another application. Typically it
will consist of the software that implements a specific control
system (e.g. the TCS or ECS), provides EPICS device or driver
support software or provides a software library. Support module
software is located in a directory tree with its top-level called
support, with a structure as described in section 7.1.1 below.</p>
</dd>
</dl>
</li>
</ol>
<blockquote>
<div><p>It has been decided that, at Gemini, files or software that implement
the Graphical User Interface will not be part of the support module
but will be implemented separately, outside the scope of this ADE.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><dl class="simple">
<dt><strong>IOC Application</strong>. This comprises the set of files which will be</dt><dd><p>loaded and run on a specific IOC, making use of software from one
or more Support Modules. The name of the application is based on
the hostname of the IOC. So for example the IOC with hostname
<strong>AG-MK-IOC</strong> runs the application called <strong>AG-MK-IOCApp</strong>.</p>
</dd>
</dl>
</li>
</ol>
<p>IOC application software is located in a directory tree with its
top-level called ioc. The IOC application source code area contains only
files which are specific to an IOC. So, for example, software which is
identical for IOCs running the same system (e.g. IOCs that run the TCS
at Gemini North and South) would not be part of the IOC application, but
static configuration data files which differ between the two sites
<em>would</em> be included in the IOC application source code (see Section 3.9
below).</p>
</div>
<div class="section" id="software-maturity">
<h4>Software Maturity<a class="headerlink" href="#software-maturity" title="Permalink to this headline">¶</a></h4>
<p>The Gemini ADE categorizes software modules according to their
“maturity”, which is a measure of their apparent stability and
reliability. Software will be considered mature when it has been
extensively tested and is undergoing less rapid change due to fewer new
features and bug-fixes.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><strong>Unreleased</strong> software is not handled as part of the development</dt><dd><p>environment and does not have a location in the standard ADE
directory structure. This is software in its initial development
and test stage which is not yet available for use by other users.
The development and test work will typically be performed in a
developer’s home directory area. However, such software can be
used when developing and testing an IOC application or support
module in the ‘work’ area.</p>
</dd>
</dl>
</li>
</ol>
<p>There are two maturity categories for released software supported by the
ADE:</p>
<ol class="arabic simple" start="2">
<li><dl class="simple">
<dt><strong>Work</strong> software. This software is in a state ready for initial use</dt><dd><p>with the real hardware but is considered to be under test and not
ready for final release. It would typically be used during
commissioning or engineering periods but is not intended to be
used during routine operations. It should be of a sufficient
quality to allow it to be used in other IOCs applications other
than the associated test application.</p>
</dd>
</dl>
</li>
</ol>
<blockquote>
<div><p>The work software will have been released from the user’s development
area and installed in the appropriate directory tree (top-level work)
in the standard directory structure. No version name is associated
with software modules released in the work area, although at any time
the software can be tagged in the SVN code repository.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><dl class="simple">
<dt><strong>Prod(uction)</strong> software<strong>.</strong> This software is in a well-tested</dt><dd><p>state, ready for routine operational use. It will normally have
been previously located in the work area. The software is released
and installed, with an associated version name, in the appropriate
directory tree (top-level prod) in the standard directory
structure. The software is protected with read-only access.
Multiple versions of production release software modules will be
maintained simultaneously. Each version name corresponds to the
tag with that name in the SVN code repository.</p>
</dd>
</dl>
</li>
</ol>
<p>Production software should be only dependent on production modules i.e.
there should be no dependencies on software in the ‘work’ area.</p>
</div>
</div>
<div class="section" id="vendor-software">
<h3>Vendor Software<a class="headerlink" href="#vendor-software" title="Permalink to this headline">¶</a></h3>
<p>Vendor software is any software imported from outside Gemini: this may
be EPICS modules or any other software. Vendor software can be managed
within the ADE. Scripts are provided (see section 8) to handle vendor
software within the SVN repository. An SVN branch is created i.e.
“/vendor” where the source code is exactly as received from the 3rd
party, before any local modifications might be made.</p>
</div>
<div class="section" id="software-dependencies">
<h3>Software Dependencies<a class="headerlink" href="#software-dependencies" title="Permalink to this headline">¶</a></h3>
<p>An IOC application (or another support module) will usually depend on
specific versions of one or more software support modules. It will
always depend on the specific version of EPICS. The specific module
version could be either:</p>
<ul class="simple">
<li><p>A released version stored within <strong>prod</strong> e.g. streamDevice version
2.2 in /gem_sw/prod/R3.14.12.4/support/streamDevice/2-2.</p></li>
<li><p>A version in <strong>work</strong> e.g. the currently version of AG being worked
on, in /gem_sw/work/R3.14.12.4/support/AG</p></li>
<li><dl class="simple">
<dt>A version within a private directory e.g. an initial version of a new</dt><dd><p>module, under test in the developer’s home directory:</p>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div><p>/home/ptaylor/devel/tcs</p>
</div></blockquote>
<p>Wherever possible, a released version stored within <strong>prod</strong> should only
be dependent on other production modules. A file called <strong>RELEASE</strong> in
the application’s <strong>configure</strong> directory is used to define the modules
being used and their locations.</p>
<p>The file contains a list of macros which define file paths pointing to
the top-level directory of the required support modules. If we assume
that the module being built references support modules called modA, modB
and modC, the build system passes all these paths to the different tools
used in building an IOC e.g.</p>
<ul class="simple">
<li><p>The tool which creates single executable file by linking to libraries
from modA, modB and modC.</p></li>
<li><p>The tool which creates a single, master dbd file by combining the
“dbd” files from modA, modB and modC.</p></li>
<li><p>The Makefile creates “db” file(s) for the IOC by copying files from
the built “db” directories of modA, modB and modC and placing the
result in the IOC’s “db” directory.</p></li>
</ul>
<p>The potential exists for conflicting dependencies, for example where a
module has a dependency on multiple modules, which have dependencies on
different versions of a single module. In principle, only a single,
specified version of a dependent module should be used everywhere when a
module is built. Such conflicts are automatically detected and flagged
at build time.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Let us assume we are building a development version of an IOC
application (in <strong>work</strong>) and that it depends on support modules “modA”,
“modB” and “modC”. modA is being developed within a developer’s home
directory, modB is a version in <strong>work</strong> and modC is a released version
(x-y) in <strong>prod</strong>.</p>
<p>In this case <strong>configure/RELEASE</strong> might contain the lines</p>
<p>SUPPORT=/gem_sw/prod/R3.14.12.4/support</p>
<p>WORK=/gem_sw/work/R3.14.12.4/support</p>
<p>HOME=/home/ptaylor/devel/AG</p>
<p>MODA=$(HOME)/modA</p>
<p>MODB=$(WORK)/modB</p>
<p>MODC=$(SUPPORT)/modC/x-y</p>
</div>
</div>
<div class="section" id="host-and-target-architecture-builds">
<h3>Host and Target Architecture Builds<a class="headerlink" href="#host-and-target-architecture-builds" title="Permalink to this headline">¶</a></h3>
<p>The only host architecture supported by the Gemini ADE is Linux 64-bit
CentOS (EPICS architecture name linux-x86_64). The host machines, in
particular the build server, must be compatible with the ADE tools, such
as the scripts and compilers provided. Multiple target architectures are
supported by the directory structure: Linux 64-bit and RTEMS using Board
Support packages (BSPs) for MVME2700 and MVME6100 PowerPC boards.</p>
<p>When EPICS is built, the file
$EPICS_BASE/configure/os/CONFIG_SITE.&lt;hostarch&gt;.Common defines the list
of target (cross-compilation) target architectures using the variable
CROSS_COMPILER_TARGET_ARCHS. Both target architectures should be defined
here and EPICS will be built for the host and both targets.</p>
<p>By default, any application build will build for the cross-compilation
architectures defined in EPICS Base. To restrict your application build
to one or the other (or neither), edit the local configure/CONFIG_SITE
file in your application module to redefine the value of the
CROSS_COMPILER_TARGET_ARCHS variable.</p>
<p>For example, to build only for RTEMS MVME2700, the line in
configure/CONFIG_SITE would be:</p>
<p>CROSS_COMPILER_TARGET_ARCHS = RTEMS-mvme2307</p>
<p>To build only for the host (no cross compilation targets), the variable
should be set to blank, so the line in configure/CONFIG_SITE would be:</p>
<p>CROSS_COMPILER_TARGET_ARCHS =</p>
</div>
<div class="section" id="local-configuration-data">
<h3>Local Configuration Data<a class="headerlink" href="#local-configuration-data" title="Permalink to this headline">¶</a></h3>
<p>Many of the real-time Gemini control systems operate at both North and
South sites, controlling almost identical hardware at each location.
Inevitably, there will be differences between the two sites, an obvious
example being the geographical location (latitude, longitude and
altitude). There will also be different operational parameters as well
as hardware differences between the two sites.</p>
<p>Although, in principle, the operational software for a given control
system should be identical at Gemini North and South, in practice
different versions of the same software modules have evolved over the
years. The intention is that software source code variations between
North and South systems will be eliminated as part of future upgrade
work and any location specific system differences will instead be
implemented using configuration data, as described below.</p>
<div class="section" id="static-and-dynamic-configuration">
<h4>Static and Dynamic Configuration<a class="headerlink" href="#static-and-dynamic-configuration" title="Permalink to this headline">¶</a></h4>
<p>Configuration data will be used by software running on the Gemini IOCs
at Gemini North and South. Typically, the data will be read from files
by application software on startup. We define two types of configuration
data, as follows:</p>
<ol class="arabic simple">
<li><p><strong>Static Configuration Data</strong>. This is data that changes rarely,
perhaps only after a significant change, or new feature added, to the
system. Some location specific configuration data will never change –
for example, the site latitude and longitude. Files containing this
type of data are managed within the ADE, stored under SVN as part of
the IOC application and, when in production, associated with a
specific release. Changes in static data will require a new release
of the IOC application.</p></li>
<li><p><strong>Dynamic Configuration Data</strong>. This is data that changes more
frequently, perhaps with each telescope run or even on a nightly
basis. Changes in dynamic data <em>will</em> <em>not</em> require a new software
release. Dynamic data will not be stored as part of a support module
or IOC application and so is not handled within the ADE. The data
files will be stored in a separate area under SVN.</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="software-development-process">
<h2>Software Development process<a class="headerlink" href="#software-development-process" title="Permalink to this headline">¶</a></h2>
<p>The development process to be adopted for a software module which is
used by the Gemini Real Time systems is summarized in below. The
software module may be either a support module or IOC application.
Almost all interactions with the SVN repository are performed using the
ADE Python scripts (named gem-<a href="#id4"><span class="problematic" id="id5">*</span></a>.py), not with direct SVN commands.</p>
<p>Figure Gemini ADE Software Development Process.</p>
<p>When developing software using the SVN repository, there are typically
three different scenarios we encounter. We will consider each one of
these in turn.</p>
<p>In the following descriptions, ADE Python script names are displayed in
bold italic e.g. <strong>gem-checkout-module.py</strong>. These scripts are described
in more detail in Chapter 8.</p>
<blockquote>
<div><p>Normal Module Development</p>
</div></blockquote>
<hr class="docutils" />
<p>This is the steady development of a support module or IOC application
along a linear development/release schedule.</p>
<ul class="simple">
<li><p>For the case where we are modifying an existing support module or IOC
application (bug-fixes or adding new features), development begins by
running <strong>gem-checkout-module.py</strong>.</p></li>
<li><p>For the case where we are creating a completely new support module or
IOC application, development begins by running
<strong>gem-start-new-module.py</strong>.</p></li>
<li><p>If the code for a new module has already been supplied by an external
vendor it should be imported using .</p></li>
</ul>
<p>The first stage of the development process will typically take place in
a sub-directory of the developer’s home directory. Testing of an IOC
application will involve using a development IOC and changing the boot
parameters on that IOC to point at the built startup script located in
the “bin/&lt;target architecture&gt;” directory underneath the top-level of
their application. The user will need to edit “configure/RELEASE” to
define the software dependencies, following the guidelines in section
3.7. Commits to Subversion can be done at any time to provide
traceability.</p>
<p>When the new version on trunk is ready it can be checked out into
<strong>work</strong> for testing on an operational IOC. <strong>gem-checkout-module.py</strong>
is run to check-out the support module or IOC application from the trunk
into the <strong>work</strong> tree. For an IOC application, the script:
<em>configure-ioc</em> should be run to modify the IOC boot script location
(see section 6.2) and set this particular IOC to boot from the <strong>work</strong>
version. The user may need to edit “configure/RELEASE” to define the
software dependencies, following the guidelines in section 3.7. Commits
to Subversion can be done at any time to provide traceability.</p>
<p>At the end of development in <strong>work</strong>, the application will either be
ready or not ready to be released to the <strong>prod</strong> area. In either case,
the <em>configure-ioc</em> script must be run again so that the production IOC
boots from the <strong>prod</strong> tree i.e. it must not be left pointing at the
<strong>work</strong> tree once the testing is finished</p>
<p>When the system is considered to be ready for release,
<strong>gem-release.py</strong> is run to generate a release tag and export the
application to the <strong>prod</strong> area. If possible, <strong>gem-release.py</strong> will
also do a test build first, before scheduling the module to be checked
out and built in <strong>prod</strong> by the build server. The next time the build
cron job runs on the build server, it will notice a scheduled build,
check the module out and build it.</p>
<p>Which Linux version to use is determined by the EPICS release – the
build process associates a particular EPICS release with a specific
Linux version. No manual editing of the “configure/RELEASE” file is
required at this stage (the release process will edit it if you are
releasing for a different EPICS version than specified in the Subversion
version of the file). When the production IOC is directed to use the
newly released module using a new boot link and rebooted, it will pick
up the new release.</p>
<div class="section" id="major-redevelopment">
<h3>Major Redevelopment<a class="headerlink" href="#major-redevelopment" title="Permalink to this headline">¶</a></h3>
<p>This occurs when a significant change is required to a support module or
IOC application and we expect this to take a long time to implement.
During this period of time, we will still need to be able to modify the
existing support module or IOC application as a result of user demands,
including bug fixes. A “feature branch” is therefore created which will
be used to develop and test the application including the new feature.</p>
<p>This process is basically the same as Normal Module Development
described in section 4.1, for the first phase “Initial Development”.</p>
<p>However in this case development begins by running
<strong>gem-start-feature-branch.py</strong><em>rather</em> than
<strong>gem-start-new-module.py</strong><em>or</em><strong>gem-checkout-module.py</strong>. Also
<strong>gem-sync-from-trunk.py</strong> should be run periodically to keep the code
up to date with what is in trunk. When complete the feature branch
should be merged back into trunk using the “<em>svn merge</em>” command.</p>
</div>
<div class="section" id="bug-fix-to-released-code">
<h3>Bug Fix to Released Code<a class="headerlink" href="#bug-fix-to-released-code" title="Permalink to this headline">¶</a></h3>
<p>This occurs when a support module or IOC application has been released
to production (the <strong>prod</strong> area), some time has elapsed and bugs have
been found. We have to fix the bugs for this particular release, despite
the fact that further development and later releases of this support
module or IOC application have been made since the release.</p>
<p>This situation is not intended to happen in normal circumstances and it
should be avoided where possible.</p>
<p>This process is basically the same as Normal Module Development
described in section 4.1, for the first phase “Initial Development”.</p>
<p>However in this case development begins by running
<strong>gem-start-bugfix-branch.py</strong><em>rather</em> than
<strong>gem-start-new-module.py</strong><em>or</em><strong>gem-checkout-module.py</strong>. Unlike
the Major Development process the script <strong>gem-sync-from-trunk.py</strong> is
not to be used. Also when running <strong>gem-release.py</strong> the <strong>–b</strong> option
must be used.</p>
<p>The developer must check that this bug is fixed in the trunk as well as
in this branch. The branch should be deleted after the bug has been
fixed in the trunk.</p>
</div>
</div>
<div class="section" id="development-examples">
<h2>Development Examples<a class="headerlink" href="#development-examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples illustrate the development of applications using
the Gemini Application Development Environment. The development cases
are based on those presented above in Section 4 (Software Development
process).</p>
<p>It is assumed that the standard Gemini ADE development platform (PC
running the CentOS 6.5 operating system) is used and that the
application is to be cross-compiled and run on either an MVME6100 or
MVME2700 VME board, running the RTEMS real-time operating system.</p>
<div class="section" id="create-new-support-module-install-in-work-area">
<h3>Create new support module: install in work Area<a class="headerlink" href="#create-new-support-module-install-in-work-area" title="Permalink to this headline">¶</a></h3>
<p>In this case we are creating a new support module called testsupp and
building an initial version in the work area.</p>
<p>An example support module called adeTest is supplied with the Gemini ADE
(released in the directory TestApps/support) and software from this
module is used in this example.</p>
<ol class="arabic simple">
<li><p>Create a new directory in your development area. From this new
directory, issue the following command to create a new support
module, using a standard ADE template</p></li>
</ol>
<blockquote>
<div><p>$ gem-start-new-module.py testsupp</p>
<p>This will create a new, minimal, support module using the template
files. It will have little or no functionality. A functional EPICS
module, including a database with supporting software, should be
created by developing the required files – this is described in the
following section.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Populate and modify files, as necessary, in the directories of the
new support module application area (testsuppApp). The relevant files
&amp; directories to be copied over (or created) are</p>
<ol class="loweralpha simple">
<li><dl class="simple">
<dt>The file configure/RELEASE that defines software dependencies, can</dt><dd><p>be copied from directory adeTest/configure. The example support
module adeTest has dependencies on the slalib, timelib, genSub
and sncseq (EPICS sequencer) modules. Ensure that the specified
versions of the modules, as defined in this file, do exist in
the stated locations.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The testsuppApp/src directory. The C, SNC source code (.st ) files</dt><dd><p>and the associated Makefile can be copied from directory
adeTest/adeTestApp/src.</p>
</dd>
</dl>
</li>
<li><p>Edit the file src/Makefile as follows</p></li>
</ol>
</li>
</ol>
<ul class="simple">
<li><dl class="simple">
<dt>Change the support library (target LIBRARY_IOC) name so that it has</dt><dd><p>the same name as the application (testsupp).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Change the .dbd file (target DBD) name so that it has the same name</dt><dd><p>as the application (testsupp.dbd).</p>
</dd>
</dl>
</li>
<li><p>Edit all the target name macro prefixes to be <a href="#id17"><span class="problematic" id="id18">testsupp_</span></a>.</p>
<ol class="loweralpha simple">
<li><dl class="simple">
<dt>The testsuppApp/Db directory, where database schematic (.sch)</dt><dd><p>files and symbol (.sym) files are located, for use with TDCT.
These files and the associated Makefile can be copied from
directory adeTest/adeTestApp/Db.</p>
</dd>
</dl>
</li>
</ol>
</li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Build the testsupp support module software by issuing a make command
from its top-level directory.</p></li>
<li><p>Assuming the software builds OK (without error), all new and modified
files should be committed in the testsupp module in the Subversion
repository. Ensure that only source files, not executables or
binaries, are added to the repository.</p></li>
<li><p>Using <strong>gem-checkout-module.py</strong>, the module should then be checked
out into the <strong>work</strong> area for testing on an operational IOC. For
this module, the location would be
/gem_sw/work/R3.14.12.4/support/testsupp</p></li>
</ol>
<blockquote>
<div><p>The script <strong>gem-checkout-module.py</strong> checks out the files into the
current working directory, so the commands would be:</p>
<p>$ cd /gem_sw/work/R3.14.12.4/support</p>
<p>$ gem-checkout-module.py testsupp</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Build the support module software by issuing a make command from the
top-level directory of the checked-out application in the <strong>work</strong>
area i.e.</p></li>
</ol>
<p>$ cd /gem_sw/work/R3.14.12.4/support/testsupp</p>
<p>$ make</p>
</div>
<div class="section" id="create-new-ioc-module-install-in-work-area">
<h3>Create new IOC module: install in work Area<a class="headerlink" href="#create-new-ioc-module-install-in-work-area" title="Permalink to this headline">¶</a></h3>
<p>In this case we are creating a new IOC application module called
GEMTEST-MK-IOC and making an initial installation in the work area.</p>
<p>An example IOC application module called PBT is supplied with the Gemini
ADE (released in the directory TestApps/ioc) and software from this
module is used in this example.</p>
<ol class="arabic simple">
<li><p>Create a new directory in your development area. From this new
directory, issue the following command to create a new IOC
application module, using a standard ADE template</p></li>
</ol>
<p>$ gem-start-new-module.py –i GEMTEST/MK</p>
<blockquote>
<div><p>This will create a new, minimal, IOC application module using the
template files. It will have little or no functionality.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Populate and modify files in the local directories in the iocBoot
directory and the App area (GEMTEST-MK-IOCApp) files, as necessary.
The relevant files &amp; directories to be copied over (or created) are</p></li>
</ol>
<ol class="loweralpha simple">
<li><dl class="simple">
<dt>Edit the file configure/RELEASE that defines software dependencies.</dt><dd><p>All modules used in the IOC should be specified here. Ensure that
the software modules have their locations specified correctly.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The App/src directory. This will contain a standard C++ source file</dt><dd><p>called, in this case, GEMTEST-MK-IOCMain.cpp. This file should not
be modified.</p>
</dd>
</dl>
</li>
</ol>
<blockquote>
<div><p>The Makefile should be modified to define the support module files
required by this IOC. In particular, the target macros
GEMTEST-MK-IOC_DBD and GEMTEST-MK-IOC_LIBS should be redefined,
adding lines which name the dbd and library files from the relevant
support modules.</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><dl class="simple">
<dt>The App/Db directory. The Makefile should be modified to define the</dt><dd><p>built database (.db) files that will be loaded on this IOC.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The App/config directory. This directory contains configuration data</dt><dd><p>files which are specific to this IOC. A pvload specification (.pv)
file should be created in this directory and the Makefile edited
to use this file when building in this directory.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The iocBoot directory, with subdirectory iocGEMTEST-MK-IOC will</dt><dd><p>contain the source startup script for this IOC, which in this case
will be called stGEMTEST-MK-IOC.src. Edit the script and Makefile
to ensure that the correct IOC name is used.</p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple" start="3">
<li><p>Build the IOC application software by issuing a make command from its
top-level directory.</p></li>
<li><p>If you wish to test the IOC booting directly from the IOC application
software module built in your own development area, then the full
boot script path will need to be specified with the configure-ioc
script.</p></li>
</ol>
<blockquote>
<div><p>For example, to boot the IOC called GEMTEST-MK-IOC from the private
directory area /home/ptaylor/gemdev, then the configure-ioc script
would be called with the –b option specifying the boot script path,
as follows</p>
</div></blockquote>
<p>$ configure-ioc –b
/home/ptaylor/gemdev/GEMTEST/MK/bin/&lt;arch&gt;/stGEMTEST-MK-IOC.boot \</p>
<p>GEMTEST-MK-IOC</p>
<blockquote>
<div><p>where &lt;arch&gt; is the RTEMS architecture of the IOC, either
RTEMS-beatnik or RTEMS-mvme2307.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Assuming the software builds OK, any altered files should be
committed to the Subversion repository.</p></li>
<li><p>The IOC application module should be checked out from the Subversion
repository into the appropriate directory in the <strong>work</strong> area, for
testing on an operational IOC. In accordance with the ADE directory
naming conventions, in this case the directory will be
/gem_sw/work/R3.14.12.4/ioc/GEMTEST/MK.</p></li>
</ol>
<blockquote>
<div><p>The script called <strong>gem-checkout-module.py</strong> is used to check-out the
IOC module from the trunk into this directory, using the following
command</p>
<p>$ gem-checkout-module.py –i GEMTEST/MK</p>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Build the IOC application software by issuing a make command from the
top-level directory of the checked-out application in the <strong>work</strong>
area.</p></li>
<li><p>Having built the IOC application module in the <strong>work</strong> area, the
configure-ioc script should be used to tell the IOC to boot from the
<strong>work</strong> directory. The command to define the boot location is:</p></li>
</ol>
<blockquote>
<div><p>$ configure-ioc –t work GEMTEST-MK-IOC</p>
<p>Further information about the boot conventions used by the ADE (the
redirector system) and the configure-ioc script can be found in
section 6.1.</p>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>Reboot the IOC called GEMTEST-MK-IOC and ensure that it operates as
expected. The IOC should boot without error and issuing the IOC Shell
command dbl should show the expected database records.</p></li>
</ol>
</div>
<div class="section" id="modify-existing-modules-installed-in-the-work-area">
<h3>Modify existing Modules installed in the work area<a class="headerlink" href="#modify-existing-modules-installed-in-the-work-area" title="Permalink to this headline">¶</a></h3>
<p>In this case we are modifying an existing support module or IOC
application (bug-fixes or new features), development begins by running
<strong>gem-checkout-module.py</strong>.</p>
<p>The project is checked out of the SVN repository into a sub-folder of
the current working directory.</p>
<p>To check out a support module called testsupp:</p>
<p>$ gem-checkout-module.py testsupp</p>
<p>To check out an IOC application module called GEMTEST-MK-IOC:</p>
<p>$ gem-checkout-module.py –i GEMTEST/MK</p>
<p>Software development then proceeds in the same way as for new modules,
as described above in sections 5.1 and 5.2 with the software checked out
and built in the same <strong>work</strong> area and the IOC configured to boot from
there.</p>
</div>
<div class="section" id="release-support-module-to-prod-area">
<h3>Release support module to prod area<a class="headerlink" href="#release-support-module-to-prod-area" title="Permalink to this headline">¶</a></h3>
<p>When a support module in the <strong>work</strong> area is considered properly tested
and reliable enough for production use, it should be released as a named
version in the <strong>prod</strong> area.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>The gem-release.py script is used to release a support module to the</dt><dd><p><strong>prod</strong> tree. The released software is tagged in the release area
of the repository and the build server then checks out and builds
the specified version in the appropriate location in the <strong>prod</strong>
area.</p>
</dd>
</dl>
</li>
</ol>
<blockquote>
<div><p>To release a version, which we will call 1-0, of the testsupp support
module, issue the command:</p>
<p>$ gem-release.py testsupp 1-0</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The build server will build the support module version 1-0 in the
read-only directory</p></li>
</ol>
<blockquote>
<div><p>/gem_sw/prod/R3.14.12.4/support/testsupp/1-0</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>The gem-release.py script starts by running a test build on the local
machine: if this fails, the build server will not attempt to perform
the build. If the build server runs the build but it fails with
errors, then an email will be generated containing the error messages
from the build procedure. Error messages will be seen in the files
build*.log and build*.err in the software build directory.</p></li>
</ol>
</div>
<div class="section" id="release-ioc-module-to-prod-area">
<h3>Release IOC module to prod area<a class="headerlink" href="#release-ioc-module-to-prod-area" title="Permalink to this headline">¶</a></h3>
<p>When an IOC application module in the <strong>work</strong> area is considered
properly tested and reliable enough for production use, it should be
released as a named version in the <strong>prod</strong> area.</p>
<ol class="arabic simple">
<li><p>The gem-release.py script is used to release an IOC application
module to the <strong>prod</strong> tree. The released software is tagged in the
release area of the repository and the build server then checks out
and builds the specified version in the appropriate location in the
<strong>prod</strong> area.</p></li>
</ol>
<blockquote>
<div><p>To release a version, which we will call 1-0, of the GEMTEST-MK-IOC
IOC module, issue the command:</p>
<p>$ gem-release.py –i GEMTEST/MK 1-0</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The build server will build the GEMTEST-MK-IOC IOC module version 1-0
in the read-only directory</p></li>
</ol>
<blockquote>
<div><p>/gem_sw/prod/R3.14.12.4/ioc/GEMTEST/MK/1-0</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>It is intended that IOCs installed in the prod area should normally
have dependencies only on support modules in the prod area. Having
successfully built and released all the support modules used by the
IOC GEMTEST-MK-IOC, the configure/RELEASE file should be edited
accordingly.</p></li>
<li><p>Having successfully released the IOC application module to the
<strong>prod</strong> area, the configure-ioc script should be run to define the
IOC boot script location (see section ), setting the IOC to boot from
the <strong>prod</strong> area version 1-0. The IOC must have its hostname set to
GEMTEST-MK-IOC. The procedure is similar to that described above in
section 5.2, but with the released version of the IOC specified. In
this case, the command to define the boot location is:</p></li>
</ol>
<blockquote>
<div><p>$ configure-ioc –v 1-0 GEMTEST-MK-IOC</p>
</div></blockquote>
</div>
<div class="section" id="feature-branch-major-redevelopment">
<h3>Feature Branch : Major Redevelopment<a class="headerlink" href="#feature-branch-major-redevelopment" title="Permalink to this headline">¶</a></h3>
<p>When a significant change is required to a support module or IOC
application and we want to be able to continue modifying the existing
support module or IOC application, a “feature branch” can be created
which will be used to develop and test the application including the new
feature.</p>
<ol class="arabic simple">
<li><p>The development of the branch is begun by running
<strong>gem-start-feature-branch.py</strong>. The project is checked out of the
SVN repository into a sub-folder of the current working directory. To
create a “feature branch” (called Branch1) of the support module
testsupp, issue the command</p></li>
</ol>
<p>$ gem-start-feature-branch.py testsupp Branch1</p>
<ol class="arabic simple" start="2">
<li><p>To create a branch (called Branch1) of the IOC application
GEMTEST-MK-IOC, issue the command</p></li>
</ol>
<p>$ gem-start-feature-branch.py –i GEMTEST/MK Branch1</p>
<ol class="arabic simple" start="3">
<li><p>Software development then proceeds in a similar way as for new
modules, as described above in sections 5.1 and 5.2. However, when
the script <strong>gem-release.py</strong> is used to release the module, the
<strong>–b</strong> option must be used. The command to release the module as
version named 1-0B1from the Subversion feature branch named Branch1,
rather than from the trunk would be:</p></li>
</ol>
<blockquote>
<div><p>$ gem-release.py –b Branch1 testsupp 1-0B1</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>The script <strong>gem-sync-from-trunk.py</strong> should be run periodically to
keep the code up to date with what is in trunk. When work is
complete, the feature branch should be merged back into trunk using
the svn merge command.</p></li>
</ol>
</div>
<div class="section" id="bugfix-branch-bug-fix-to-released-code">
<h3>Bugfix Branch: Bug Fix to Released Code<a class="headerlink" href="#bugfix-branch-bug-fix-to-released-code" title="Permalink to this headline">¶</a></h3>
<p>This is the case where a support module or IOC application was
previously released to production (the <strong>prod</strong> area), and bugs have
been found. Further development and later releases of the support module
or IOC application have been made since the release, but we need to fix
the bugs in the original release.</p>
<p>The script gem-start-bugfix-branch.py is used to create a “bugfix
branch” from a specified, old version of the module.</p>
<p>Example</p>
<ol class="arabic simple">
<li><p>To create a bugfix branch of a previous release (version 1-0) of the
IOC module GEMTEST-MK-IOC, issue the command:</p></li>
</ol>
<p>$ gem-start-bugfix-branch.py -i GEMTEST/MK 1-0 1-0Branch</p>
<p>This will create the directory</p>
<p>$SVN_ROOT/gem/branches/ioc/GEMTEST/MK/1-0Branch from</p>
<p>$SVN_ROOT/gem/branches/ioc/GEMTEST/MK/1-0</p>
<p>and then checks out the branch into “./1-0Branch”.</p>
<ol class="arabic simple" start="2">
<li><p>Software development then proceeds in a similar way as for new
modules, as described above in sections 5.1 and 5.2.</p></li>
<li><p>When the script <strong>gem-release.py</strong> is used to release the module, the
<strong>–b</strong> option must be used to specify the bugfix branch name, in the
same way as for a feature branch, as described above in section 5.6.
The command to release the module as version named 1-0B1from the
Subversion bugfix branch named 1-0Branch, rather than from the trunk
would be:</p></li>
</ol>
<p>$ gem-release.py –b 1-0Branch testsupp 1-0B1</p>
</div>
</div>
<div class="section" id="booting-iocs">
<h2>Booting IOCs<a class="headerlink" href="#booting-iocs" title="Permalink to this headline">¶</a></h2>
<p>RTEMS IOCs will boot by downloading the executable and EPICS startup
scripts using tftp (Trivial File Transfer Protocol) over the network
from the host Linux PC. The tftp server on the Linux host will need to
be configured to allow access to the IOC executable file and EPICS
startup script in the Gemini ADE tree structure.</p>
<p>A summary of the settings for booting MVME2770 and MVME6100 cards over
the network is shown below. For further details, see the firmware
documentation provided by the original card manufacturer (Motorola) and
hardware configuration details documented by Gemini.</p>
<div class="section" id="boot-redirector">
<h3>Boot Redirector<a class="headerlink" href="#boot-redirector" title="Permalink to this headline">¶</a></h3>
<p>The Gemini ADE has a convention (the “redirector”) using a soft file
link with a fixed name to point to the actual boot script file currently
being used. The link has the same (fixed) name as the IOC being booted
but points to a (variable) boot script file name which depends on the
version of the IOC software being used. So, if the IOC application
module has been built in the directory
/gem_sw/work/R3.14.12.4/ioc/GEMTEST/MK</p>
<p>then the name of the boot script will be</p>
<p>/gem_sw/work/R3.14.12.4/ioc/GEMTEST/MK/bin/&lt;arch&gt;/GEMTEST-MK-IOC.boot.</p>
<p>where &lt;arch&gt; is the RTEMS architecture of the IOC, either RTEMS-beatnik
or RTEMS-mvme2307.</p>
<p>Using the configure-ioc script, the boot link is created in the
(restricted access) directory /gem_sw/prod/redirector. As long as the
software has been built in the standard work or prod areas, using this
script hides the details of the boot script name &amp; location from the
user.</p>
<p>For consistency, the IOC should have its hostname defined as
GEMTEST-MK-IOC.</p>
</div>
<div class="section" id="configure-ioc-boot-configuration-script">
<h3>configure-ioc boot configuration script<a class="headerlink" href="#configure-ioc-boot-configuration-script" title="Permalink to this headline">¶</a></h3>
<p>You might sometimes want to boot an IOC application in work and later
from a specific released version in prod. This is configured using a
soft link target and startup script, which are defined using the
configure-ioc command. Various options are available for this command
and many options will either be defaulted or prompted for. Examples:</p>
<ol class="arabic simple">
<li><p>Create (or modify) the IOC configuration for IOC AG-MK-IOC. Configure
it to boot from version 2-8 in the production area (this is the
default area).</p></li>
</ol>
<blockquote>
<div><p>configure-ioc –v 2-8 AG-MK-IOC</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Configure IOC AG-MK-IOC to boot from its work area.</p></li>
</ol>
<blockquote>
<div><p>configure-ioc –t work AG-MK-IOC</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Show the current boot configuration for the specified IOC:</p></li>
</ol>
<blockquote>
<div><p>configure-ioc -l AG-MK-IOC</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>List all configured IOCs:</p></li>
</ol>
<blockquote>
<div><p>configure-ioc -L</p>
</div></blockquote>
<p>The configure-ioc script always checks for the existence of the link and
startup script file and will normally prompt if existing files are to be
overwritten. The –f flag forces overwrite without prompting.</p>
<p>The IOC host name is checked to see whether it is a recognized host name
and asks for confirmation if it is not known.</p>
<p>The full list of options for the configure-ioc command is shown in the
following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>configure-ioc -h</p></th>
<th class="head"><p>Display help on command options.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>configure-ioc -L</p></td>
<td><p>List all existing IOC boot soft
links.</p></td>
</tr>
<tr class="row-odd"><td><p>configure-ioc -l ioc</p></td>
<td><p>List the entry for specified IOC.</p></td>
</tr>
<tr class="row-even"><td><p>configure-ioc [options] ioc</p></td>
<td><p>Create or replace the boot link entry
for the IOC named ioc.</p>
<p>where ioc = IOC host name and options
are as shown below</p>
</td>
</tr>
<tr class="row-odd"><td><p>-t area</p></td>
<td><p>Set the software area (maturity) to
be work or prod.</p>
<p>If no area is specified, you will be
prompted (default prod).</p>
<p>If prod (the default) is used, a
version should be defined using the
–v option.</p>
</td>
</tr>
<tr class="row-even"><td><p>-v version</p></td>
<td><p>Define version number. When this
option is used, the prod area is
assumed.</p></td>
</tr>
<tr class="row-odd"><td><p>-a arch</p></td>
<td><p>Set the IOC architecture for use with
-i (e.g.RTEMS-beatnik).</p>
<p>If arch is not specified, you will be
prompted.</p>
</td>
</tr>
<tr class="row-even"><td><p>-e evers</p></td>
<td><p>Specify the version of EPICS to be
used.</p>
<p>If this is not specified, the value
of the environment variable
$GEM_EPICS_RELEASE will be used.</p>
</td>
</tr>
<tr class="row-odd"><td><p>-s script</p></td>
<td><p>Provide the full boot script name
(full path).</p></td>
</tr>
<tr class="row-even"><td><p>-b boot</p></td>
<td><p>Provide the full boot file name (full
path).</p></td>
</tr>
<tr class="row-odd"><td><p>-f</p></td>
<td><p>“force” flag: if this flag is used,
then the links will be created even
when the boot or script files do not
exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="booting-mvme6100-rtems-ioc">
<h3>Booting MVME6100 RTEMS IOC<a class="headerlink" href="#booting-mvme6100-rtems-ioc" title="Permalink to this headline">¶</a></h3>
<p>We assume that RTEMS IOC’s running on MVME6100 cards will have the
Motorola MOTload firmware installed and this will be used for booting
RTEMS. Note that the card may need re-configuring to use the correct
Boot Flash Bank.</p>
<p>The appropriate MOTload global environment variables should be setup to
boot using tftp with appropriate boot parameters defined. For example,
if the Linux host has IP address 192.168.0.59 and the RTEMS IOC (an
MVME6100) with hostname AG-MK-IOC has IP address 192.168.0.65:</p>
<p>MVME6100&gt; gevShow</p>
<p>mot-script-boot</p>
<p>tftpGet</p>
<p>go -a006B7000</p>
<p>mot-/dev/enet0-cipa=192.168.0.65</p>
<p>mot-/dev/enet0-sipa=192.168.0.59</p>
<p>mot-/dev/enet0-gipa=192.168.0.1</p>
<p>mot-/dev/enet0-snma=255.255.255.0</p>
<p>rtems-client-name=AG-MK-IOC</p>
<p>epics-script=/gem_sw/redirector/AG-MK-IOC.cmd</p>
<p>epics-nfsmount=192.168.0.59:/gem_sw /gem_sw</p>
<p>mot-/dev/enet0-file=/gem_sw/redirector/AG-MK-IOC</p>
<p>Refer to the Motorola MOTload firmware manual for further details of the
standard global environment boot parameters. The environment variables
named ‘epics-<a href="#id6"><span class="problematic" id="id7">*</span></a>’ are used by EPICS at boot time to define the EPICS
startup script and the NFS mount command. The Linux host must be
configured so that /gem_sw directory can be mounted by the RTEMS IOC
using NFS.</p>
</div>
<div class="section" id="booting-mvme2700-rtems-ioc">
<h3>Booting MVME2700 RTEMS IOC<a class="headerlink" href="#booting-mvme2700-rtems-ioc" title="Permalink to this headline">¶</a></h3>
<p>We assume that RTEMS IOC’s running on MVME2700 cards will have the
Motorola PPC1-Bug firmware installed and this will be used for booting
RTEMS. Note that the card may need re-configuring to use the correct
Boot Flash Bank.</p>
<p>The PPC1-Bug environment (ENV command) variables need to be configured
correctly and the niot command used to boot using tftp with appropriate
boot parameters defined. For example, if the Linux host has IP address
192.168.0.59 and the RTEMS IOC (an MVME2700) with hostname AG-MK-IOC has
IP address 192.168.0.66, use the niot command from PPC1-Bug to set the
network boot parameters:</p>
<p>PPC1-Bug&gt;niot</p>
<p>Controller LUN =00</p>
<p>Device LUN =00</p>
<p>Node Control Memory Address =03F9E000</p>
<p>Client IP Address =192.168.0.66</p>
<p>Server IP Address =192.168.0.59</p>
<p>Subnet IP Address Mask =255.255.255.0</p>
<p>Broadcast IP Address =192.168.0.255</p>
<p>Gateway IP Address =192.168.0.1</p>
<p>Boot File Name (“NULL” for None) =/gem_sw/prod/redirector/AG-MK-IOC</p>
<p>Argument File Name (“NULL” for None)
=172.16.5.126:/gem_sw:prod/redirector/AG-MK-IOC.cmd</p>
<p>Boot File Load Address =001F0000</p>
<p>Boot File Execution Address =001F0000</p>
<p>Boot File Execution Delay =00000000</p>
<p>Boot File Length =00000000</p>
<p>Boot File Byte Offset =00000000</p>
<p>BOOTP/RARP Request Retry =00</p>
<p>TFTP/ARP Request Retry =00</p>
<p>Trace Character Buffer Address =00000000</p>
<p>BOOTP/RARP Request Control: Always/When-Needed (A/W)=W</p>
<p>BOOTP/RARP Reply Update Control: Yes/No (Y/N) =Y</p>
<p>PPC1-Bug&gt;</p>
<p>Refer to the Motorola PPCBug firmware manual for further details of the
niot boot parameters. The Argument File Name is used at boot time to
define the EPICS startup script and the NFS mount command. The Linux
host must be configured so that /gem_sw directory can be mounted by the
RTEMS IOC using NFS.</p>
</div>
</div>
<div class="section" id="ade-directory-structure-1">
<span id="id8"></span><h2>ADE Directory Structure<a class="headerlink" href="#ade-directory-structure-1" title="Permalink to this headline">¶</a></h2>
<p>The standard directory structure that will be used at Gemini for the
real-time software is shown in the figures below.</p>
<p>Figure : ADE Directory Structure</p>
<p>Notes:</p>
<ul class="simple">
<li><p>The top-level (ADE root) directory is shown as <strong>/gem_sw</strong> throughout
this document.</p></li>
<li><p><strong>/gem_sw</strong> contains the following directories:</p></li>
<li><dl class="simple">
<dt><strong>/epics</strong> - <a href="#id9"><span class="problematic" id="id10">*</span></a>EPICS source code and installed release tree. Contains</dt><dd><p>all EPICS versions in use.* Which version is used is indicated by
the directory name e.g. <strong>R3.14.12.4.</strong> <em>The version used by a
user is defined by the environment variable
$GEM_</em>EPICS_RELEASE.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>/etc</strong> - <a href="#id11"><span class="problematic" id="id12">*</span></a>contains the profile file which everyone should source if</dt><dd><p>they want to use the Gemini ADE. It may also contain other
system-wide configuration files.*</p>
</dd>
</dl>
</li>
<li><p><strong>/prod</strong></p></li>
<li><dl class="simple">
<dt><strong>/etc –</strong> Files used by the build system, such as scripts used by</dt><dd><p>the build server</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>/common –</strong> Common scripts and tools used by the ADE. In</dt><dd><p>particular, subdirectory <strong>python</strong> contains python scripts.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>/Rx.y.z</strong> - Released versions of software checked out from</dt><dd><p>Subversion; built using the named EPICS releases. Which version is
used is indicated by the directory name e.g. <strong>prod/R3.14.12.4.</strong></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>/targetOS</strong> - <a href="#id13"><span class="problematic" id="id14">*</span></a>Cross compilation environments for building target</dt><dd><p>systems. Currently only RTEMS is available.*</p>
</dd>
</dl>
</li>
<li><p><strong>/tools</strong> - <em>external controls applications</em> (not currently used).</p></li>
<li><dl class="simple">
<dt><strong>/work</strong> – Development files and built dependents. Allows sharing of</dt><dd><p>non-production files between IOCs.</p>
</dd>
</dl>
</li>
<li><p>Note that a system in <strong>work</strong> may be using some support modules from
<strong>prod</strong> and others from <strong>work</strong>, as well as versions from a
developer’s home directory. Which is used is defined in the
configuration files for an individual system.</p></li>
<li><p>The format of the EPICS and RTEMS file trees inside <strong>epics</strong> and
<strong>targetOS</strong> is the same as distributed and documented by the
suppliers.</p></li>
<li><p>All local developed software is kept under either <strong>prod</strong> or
<strong>work.</strong></p></li>
<li><p>The developer’s home test area is not shown. This is typically their
home directory or on a local scratch disk. Note that home directories
should be, by default, globally readable.</p></li>
</ul>
<blockquote>
<div><p>work Directory</p>
</div></blockquote>
<hr class="docutils" />
<p>The work directory tree contains code that is still under development
but of a sufficient quality to allow it to be used in other IOC’s
applications other than a local test application. The software is
located within the tree for the EPICS release with which they were built
and with which they can be used.</p>
<p>For a particular EPICS release there will be <strong>support</strong> and <strong>ioc</strong>
sub-directories.</p>
<blockquote>
<div><p>work/&lt;EPICS Release&gt;/support</p>
</div></blockquote>
<hr class="docutils" />
<p>A set of support modules is stored in directories beneath this
directory. The figure below shows an example directory hierarchy within
<em>/gem_sw/work/R3.14.12.4/support</em> for a support module called astlib.
The diagram is expanded for a single support module (astlib); there
would be many other, similar hierarchies in
<em>/gem_sw/work/R3.14.12.4/support.</em></p>
<p><img alt="image3" src="../_images/image6.wmf" /></p>
<p>Figure 3 Contents of /gem_sw/work/R3.14.12.4/support</p>
<p>In the figure, the <strong>include</strong>, <strong>db</strong>, <strong>dbd</strong>, <strong>data</strong> and <strong>lib</strong>
directories are coloured red to mark the fact that they do not contain
source files but are produced by the build process. They must not be
stored in Subversion<strong>.</strong> Note that not every module will have all the
sub-directories shown. In particular, modules which are purely libraries
may not have an associated database files in /db,or /dbd.</p>
<ul class="simple">
<li><p><strong>include</strong> - contains the header files for this module, especially
those which define interfaces to this module which other applications
may want to use.</p></li>
<li><p><strong>db</strong> – contains any database and template files provided for this
module, these will have the “.sch” , “.db” or “.template” file
extension.</p></li>
<li><p><strong>dbd</strong> – contains any database definition files which are unique to
this module.</p></li>
<li><p><strong>lib</strong>/… - objects for host and target architectures and operating
systems, determined by the cross-compilation configuration in
configure/CONFIG_SITE.</p></li>
<li><dl class="simple">
<dt><strong>lib/RTEMS-mvme2307</strong> – contains the object library for RTEMS</dt><dd><p>applications running on the Motorola MVME2700 board. If
cross-compilation is being done for the MVME6100 target then there
would be a similar directory called <strong>lib/RTEMS-beatnik</strong>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>lib/linux-x86_64</strong> – contains the object library for Linux 64-bit</dt><dd><p>applications.</p>
</dd>
</dl>
</li>
</ul>
<p>The <strong>configure</strong> directory contains the configuration and make rules
which will be used when building the application. These would be the
standard EPICS rules with some additional, locally defined rules.</p>
<p>The only file that normally requires editing is configure/RELEASE which
contains the list of other applications (or more specifically, support
modules) on which this application/module depends and the location of
these applications. See section 3.7 for more details.</p>
<p>The file configure/CONFIG_SITE may need to be edited when the module is
created, to define the required cross-compilation architectures (see
Section 3.8 above).</p>
<p>The <strong>astlibApp</strong> is the application directory, containing
sub-directories containing the source code files for this support
module:</p>
<ul class="simple">
<li><p><strong>src</strong> – contains C/C++ source code, scripts, database definition
(.dbd) and sequencer (.st) source code files for this module.</p></li>
<li><p><strong>Db</strong> – contains any database schematic and symbol files defined for
this module. These will have the <strong>“</strong>.sch” and <strong>“</strong>.sym” extensions
for use with TDCT. It will usually contain a local TDCT configuration
file called tdct.cfg.</p></li>
</ul>
<blockquote>
<div><p>work/&lt;EPICS Release&gt;/ioc</p>
</div></blockquote>
<hr class="docutils" />
<p>The <strong>ioc</strong> directory hierarchy contains the files that are used
operationally for specific IOCs. The figure below shows the directory
hierarchy within <em>/gem_sw/work/R3.14.12.4/ioc/AG/MK</em> which contains the
code to generate the IOC for the A&amp;G (AG) subsystem IOC at Gemini North
(MK). This IOC’s full name is therefore AG-MK-IOC.The diagram expands a
single IOC instance (MK) but similar hierarchies will exist throughout
<em>/gem_sw/work/R3.14.12.4/ioc.</em></p>
<p><img alt="image4" src="../_images/image7.wmf" />Figure Contents of /gem_sw/work/R3.14.12.4/ioc</p>
<p>In the figure the <strong>db</strong>, <strong>dbd</strong>, <strong>data</strong> and <strong>bin</strong> directories are
coloured red to mark the fact that they do not contain source files but
are created during the build process. They must not be stored in
Subversion.</p>
<ul class="simple">
<li><p><strong>db</strong> – contains the built database (<a href="#id15"><span class="problematic" id="id16">*</span></a>.db) files for this IOC.</p></li>
<li><p><strong>dbd</strong> – contains a single (master) database definition file (.dbd
file) for this IOC.</p></li>
<li><p><strong>data</strong> – contains architecture independent files e.g. configuration
data files specific to this IOC.</p></li>
<li><p><strong>bin/RTEMS-mvme2307</strong> – will contain object file called AG-MK-IOC
containing the compiled code for an IOC running RTEMS on an MVME2700
processor. The binary file incorporates the EPICS base software as
well as any support module software that this IOC depends upon. This
directory also contains the installed startup script
(stAG-MK-IOC.boot) file used when booting this IOC.</p></li>
<li><p><strong>bin/linux-x86_64</strong> – will contain a file called AG-MK-IOC. This
will be an x86_64 executable file appropriate for running this IOC on
a 64 bit Linux target. This directory also contains the installed
startup script (stAG-MK-IOC.boot) file used when booting this (soft)
IOC.</p></li>
</ul>
<p>The <strong>configure</strong> directory contains the configuration and make rules
which will be used when building the application. These would be the
standard EPICS rules with some additional, locally defined rules.</p>
<p>The only file that normally requires editing is configure/RELEASE which
contains the list of other applications (or more specifically, support
modules) on which this application/module depends and the location of
these applications. See section 3.7 for more details.</p>
<p>The file configure/CONFIG_SITE may need to be edited when the module is
created, to define the required cross-compilation architectures (see
Section 3.8 above).</p>
<p>The <strong>AG-MK-IOCApp</strong> directory includes sub-directories which contain
the source files specific to this IOC:</p>
<ul class="simple">
<li><p><strong>src</strong> – The source files on which an IOC depends are normally found
in the relevant support modules “src” directory. However, every
application under EPICS 3.14 includes a special C++ source file,
called &lt;App&gt;Main.cpp, (in this case, AG-MK-IOCMain.cpp). This source
file runs the soft IOC shell in the case where the application is run
on a target operating system which is not RTEMS.</p></li>
<li><p><strong>config</strong> - This directory contains configuration data files which
are specific to this IOC. This might include site-specific data used
by the application, look-up tables and specific hardware
configuration data.</p></li>
<li><p><strong>Db</strong> – contains only a Makefile which defines which databases are
to be used by this IOC. The specified database (.db) files will be
copied from the relevant module(s) using the module list defined in
file configure/RELEASE. When loaded, the EPICS database record names
will have a site-specific prefix, defined in a configuration file.</p></li>
</ul>
<p>The <strong>iocBoot</strong> directory contains subdirectory <strong>iocAG-MK-IOC</strong> which
contains the source startup script for this IOC. For this example, it
will be called st AG-MK-IOC.src.</p>
<blockquote>
<div><p>Production (“prod”) Directory</p>
</div></blockquote>
<hr class="docutils" />
<p>The <strong>prod</strong> directory hierarchy contains software that has been tested
and released for production use. The only difference between the
structure of the <strong>prod</strong> and <strong>work</strong> directory trees is that the files
for each support module and IOC are placed in a release-specific
sub-directory, with the same name as the release. For each release the
hierarchy is the same as in <strong>work</strong>. This is illustrated in the figures
below, for both support and IOC modules.</p>
<p>Figure 5 Structure of support module in /gem_sw/prod/R3.14.12.4/support</p>
<p><img alt="image5" src="../_images/image9.wmf" /></p>
<p>Figure 6 Structure of IOC application in /gem_sw/prod/R3.14.12.4/ioc</p>
</div>
<div class="section" id="ade-profile-and-environment-variables">
<h2>ADE profile and Environment Variables<a class="headerlink" href="#ade-profile-and-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>The file /gem_sw/etc/profile file contains Gemini ADE environment
definitions and this file must be sourced (usually from the ~/.bashrc
file) by anyone using the Gemini ADE. This file will need to be edited
for the local site where it is deployed. The environment variables
defined include the following</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>GEM_ROOT</p></th>
<th class="head"><p>The base directory of the Gemini ADE tree, here
assumed to be /gem-sw.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GEM_IPNUM</p></td>
<td><p>The Ethernet address of the current host’s
primary Ethernet adaptor. This is derived using
information on the local host.</p></td>
</tr>
<tr class="row-odd"><td><p>GEM_SITE</p></td>
<td><p>The Gemini site (North = “MK” or South = “CP”).
This is derived using assumptions about the LAN
network addresses at the Gemini sites.</p></td>
</tr>
<tr class="row-even"><td><p>GEM_EPICS_RELEASE</p></td>
<td><p>The EPICS release used by the Gemini ADE.</p></td>
</tr>
<tr class="row-odd"><td><p>SVN_ROOT</p></td>
<td><p>URL of the Subversion repository location e.g.
<a class="reference external" href="http://source.gemini.edu/software">http://source.gemini.edu/software</a>.</p>
<p>Note: throughout this document it is assumed
that the Gemini applications area will be
located in the Subversion repository under
$SVN_ROOT/gem</p>
</td>
</tr>
<tr class="row-even"><td><p>GEM_EMAIL_DOMAIN</p></td>
<td><p>The email domain used when sending automatic
emails from the build server. Used in the
Python script gem-release.py.</p></td>
</tr>
<tr class="row-odd"><td><p>SVN_EDITOR</p></td>
<td><p>The editor used to enter comments when using
SVN.</p></td>
</tr>
<tr class="row-even"><td><p>GEM_SCRIPTS</p></td>
<td><p>The location of the main Python ADE scripts
(names gem_*.py).</p></td>
</tr>
<tr class="row-odd"><td><p>PYTHONPATH</p></td>
<td><p>Defines where imported Python packages can be
found.</p></td>
</tr>
<tr class="row-even"><td><p>PATH</p></td>
<td><p>The executable search path, including RTEMS,
EPICS and Python scripts locations.</p></td>
</tr>
<tr class="row-odd"><td><p>HOST_ARCH</p></td>
<td><p>(EPICS) Host architecture type : linux-x86_64
for Linux 64-bit.</p></td>
</tr>
<tr class="row-even"><td><p>EPICS_RELEASE</p></td>
<td><p>(EPICS) EPICS version (same as
$GEM_EPICS_RELEASE).</p></td>
</tr>
<tr class="row-odd"><td><p>EPICS_HOST_ARCH</p></td>
<td><p>(EPICS) Host architecture type (same as
$HOST_ARCH).</p></td>
</tr>
<tr class="row-even"><td><p>EPICS</p></td>
<td><p>(EPICS) Root directory location for EPICS
version being used.</p></td>
</tr>
<tr class="row-odd"><td><p>EPICS_BASE</p></td>
<td><p>(EPICS) EPICS Base tree location.</p></td>
</tr>
<tr class="row-even"><td><p>EPICS_EXTENSIONS</p></td>
<td><p>(EPICS) EPICS Extensions tree location.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-release-scripts-reference">
<h2>Build &amp; Release Scripts Reference<a class="headerlink" href="#build-release-scripts-reference" title="Permalink to this headline">¶</a></h2>
<p>A set of Python scripts should be used to automate interactions with the
Subversion repository for software development for the Gemini systems.
The source files for the Python scripts are in the scripts/python
subdirectory of the makeGemApp module. The Makefile provided installs
the scripts into directory $GEM_ROOT/prod/common/python/GemPySvn.</p>
<p>The scripts are described in the following sections, each with a table
which displays the parameters, a description, all the available options
for the script, followed by an example.</p>
<div class="section" id="gem-start-new-module-py">
<h3>gem-start-new-module.py<a class="headerlink" href="#gem-start-new-module-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-start-new-module.py
[options] &lt;module_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Create a new support or IOC
module called &lt;module_name&gt;,
using Gemini ADE templates,
import it into the SVN
repository and check it out into
the current working directory.
Options are described below.</p>
<p>The script calls the standard
EPICS makeBaseApp.pl script,
using Gemini ADE templates to
create the new module’s
directory structure, including
an initial template Makefile in
each directory. The user then
develops the application by
creating TDCT schematic files, C
source code, configuration files
etc., and modifying the template
Makefiles appropriately.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Set the module type to be AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to create an IOC application, in
which case &lt;module_name&gt; is
expected to be of the form
“Subsystem/Location” e.g. AG/MK.</p>
<p>An additional third part of the
name may, optionally, be
provided to specify the number
for the IOC e.g. AG/MK/01. This
would only be necessary if more
than one IOC is being used for a
particular application at the
same site.</p>
</td>
</tr>
<tr class="row-odd"><td><p>-n –no_import</p></td>
<td><p>Create a local module but don’t
import into Subversion.</p></td>
</tr>
<tr class="row-even"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Examples</p>
<ol class="arabic simple">
<li><p>gem-start-new-module.py mysupport</p></li>
</ol>
<blockquote>
<div><p>The command creates this repository directory in Subversion:</p>
<p>$SVN_ROOT/gem/trunk/support/mysupport</p>
<p>and checks out the module into directory ./mysupport in the current
working directory.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>gem-start-new-module.py –i AG/MK</p></li>
</ol>
<blockquote>
<div><p>The command creates this repository directory in Subversion:</p>
</div></blockquote>
<p>$SVN_ROOT/gem/trunk/ioc/AG/MK</p>
<blockquote>
<div><p>The application source will be checked out into directory
./AG/MK/AG-MK-IOCApp.</p>
</div></blockquote>
</div>
<div class="section" id="gem-checkout-module-py">
<h3>gem-checkout-module.py<a class="headerlink" href="#gem-checkout-module-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-checkout-module.py [options]
&lt;module_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Checks out the specified support
or IOC module &lt;module_name&gt; from
the latest trunk (by default)
revision in the Subversion
repository. Checks out into the
current working directory.
Options are described below.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Set the module type to be AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to create an IOC application, in
which case &lt;module_name&gt; is
expected to be of the form
“Subsystem/Location” e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-b BRANCH –branch=BRANCH</p></td>
<td><p>Checkout the module from the
Subversion branch named BRANCH,
rather than from the trunk</p></td>
</tr>
<tr class="row-even"><td><p>-f –force</p></td>
<td><p>Disable warnings, force checkout</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-checkout-module.py –i GEMTEST/MK</p>
<p>This command will check out the IOC application GEMTEST/MK from the
trunk into the current working directory.</p>
</div>
<div class="section" id="gem-list-modules-py">
<h3>gem-list-modules.py<a class="headerlink" href="#gem-list-modules-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-list-modules.py [options]
[dom_name]</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script returns a list of
all the support modules or IOC
collections in the repository. A
parameter (dom_name) may be
supplied for ioc modules.
Without a parameter it lists all
modules in the specified area
(support or ioc).</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>List all modules of type AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to list IOC modules, in which
case &lt;dom_name&gt; is expected to
be either of the form
“Subsystem” e.g. AG or
“Subsystem/Location” e.g. AG/MK.</p>
<p>Without a parameter it lists all
modules in the ioc area</p>
</td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-list-modules.py –i GEMTEST</p>
<p>This command will list all the modules below the IOC top-level
application GEMTEST.</p>
</div>
<div class="section" id="gem-changes-since-release-py">
<h3>gem-changes-since-release.py<a class="headerlink" href="#gem-changes-since-release-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-changes-since-release.py
[options] &lt;module_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script checks if a support
or IOC module in the Subversion
repository has had any changes
committed since its last
release.</p>
<p>It shows only changes made to
the trunk version as well as any
releases.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>List modules of type AREA, where
AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to list IOC modules, in which
case &lt;module_name&gt; is expected
to be of the form
“Subsystem/Location” e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-changes-since-release.py –i GEMTEST/MK</p>
<p>This command will show any changes committed to the Subversion
repository for the IOC application GEMTEST/MK, since it was last
released.</p>
</div>
<div class="section" id="gem-logs-since-release-py">
<h3>gem-logs-since-release.py<a class="headerlink" href="#gem-logs-since-release-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-logs-since-release.py
[options] &lt;module-name&gt;
[&lt;earlier-rel&gt;] [&lt;later-rel&gt;]</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script prints all the log
messages for module
&lt;module-name&gt; in the ioc or
support area.</p>
<p>The output can be specified to
show only those changes between
the revision when &lt;earlier-rel&gt;
was done to the revision when
&lt;later-rel&gt; was done. If not
specified, &lt;earlier-rel&gt;
defaults to revision 0 and
&lt;later-rel&gt; to the head
revision.</p>
<p>If &lt;earlier-rel&gt; is given an
invalid value, it will be set to
the latest release.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>List modules of type AREA, where
AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to list IOC modules, in which
case &lt;module_name&gt; is expected
to be of the form
“Subsystem/Location” e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-v , –verbose</p></td>
<td><p>Print additional log
information, including all the
files changed in Subversion with
each revision.</p></td>
</tr>
<tr class="row-even"><td><p>-r, –raw</p></td>
<td><p>Print raw text, without colour.
If this option is not used, the
user name and revision number
are displayed using red text.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<ol class="arabic simple">
<li><p>gem-logs-since-release.py supportmod release1 release2</p></li>
</ol>
<p>This command will print all the log messages for the support module
called supportmod in SVN from the revision number when release1 was
done, to the revision when release2 was done.</p>
<ol class="arabic simple" start="2">
<li><p>gem-logs-since-release.py -i AG/MK</p></li>
</ol>
<p>No release names are provided, so this command will print all the log
messages for the IOC module called AG/MK in SVN since it was created.</p>
</div>
<div class="section" id="gem-release-py">
<h3>gem-release.py<a class="headerlink" href="#gem-release-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-release.py [options]
&lt;module-name&gt; &lt;release_#&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Release &lt;module-name&gt; at version
&lt;release_#&gt; in the production
(prod) ioc or support area.</p>
<p>This script first performs a
local test build of the module,
and if it succeeds, creates the
release in Subversion. It then
creates a build script file that
is put in a queue for use by the
ADE build server, causing it to
schedule a checkout and build of
the Subversion module release in
the production (prod) area.</p>
<p>If the release already exists in
prod, no release will be done: a
release only can be done in this
case by using the –f option.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Release module of type AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the release module type to
be ioc, in which case
&lt;module-name&gt; is expected to be
of the form “Subsystem/Location”
e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-b BRANCH –branch=BRANCH</p></td>
<td><p>Release the module from the
Subversion branch named BRANCH,
rather than from the trunk</p></td>
</tr>
<tr class="row-even"><td><p>-f, –force</p></td>
<td><p>Force a release. If the release
already exists in prod, the
existing release will be removed
and rebuilt.</p></td>
</tr>
<tr class="row-odd"><td><p>-t, –test_build</p></td>
<td><p>If set, this will skip the test
build stage and just schedule a
release.</p></td>
</tr>
<tr class="row-even"><td><p>-e EPICS_VERSION,</p>
<p>–epics_version=EPICS_VERSION</p>
</td>
<td><p>Use the specified EPICS version
for the build rather than the
default defined in environment
variable GEM_EPICS_RELEASE.</p></td>
</tr>
<tr class="row-odd"><td><p>-m MESSAGE,</p>
<p>–message=MESSAGE</p>
</td>
<td><p>Add a user message to the end of
the default Subversion commit
message. The message will be
‘&lt;module_name&gt;: Released version
&lt;release_#&gt;. &lt;message&gt;’</p></td>
</tr>
<tr class="row-even"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-release.py –i GEMTEST/MK Version1</p>
<p>This will release the IOC collection created in the example given for
gem-start-new-module above into the directory
$SVN_ROOT/gem/release/GEMTEST/MK/Version1</p>
</div>
<div class="section" id="gem-start-feature-branch-py">
<h3>gem-start-feature-branch.py<a class="headerlink" href="#gem-start-feature-branch-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-start-feature-branch.py
[options] &lt;module_name&gt;
&lt;branch_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script creates a branch of
the current state of the trunk
for a support module or IOC
application collection. The
property gem:synced-from-trunk
is added to the branch. The
branch is checked out into the
current working directory.</p>
<p>If the current working directory
is the top directory of a
working copy of the trunk (there
are .svn files present to allow
Subversion to link the current
directory with the trunk) then
the user is able to update the
current working directory so
that it is now linked with the
new branch.</p>
<p>However, if the trunk has been
changed since the trunk was
checked out into the current
working directory, then
switching to the new branch is
not possible.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Use modules of type AREA, where
AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to branch from an IOC module, in
which case &lt;module_name&gt; is
expected to be either of the
form “Subsystem/Location” e.g.
AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<blockquote>
<div><p>gem-start-feature-branch.py –i GEMTEST/MK Branch1</p>
<p>This command will create the directory</p>
<p>$SVN_ROOT/gem/branches/ioc/GEMTEST/MK/Branch1 from
$SVN_ROOT/gem/trunk/ioc/GEMTEST/MK; and then checks out the branch
into “./Branch1”</p>
<p>To see which revision of the trunk was used to create the branch run
the commands:</p>
<p>cd Branch1</p>
<p>svn proplist –verbose</p>
</div></blockquote>
</div>
<div class="section" id="gem-start-bugfix-branch-py">
<h3>gem-start-bugfix-branch.py<a class="headerlink" href="#gem-start-bugfix-branch-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-start-bugfix-branch.py
[options] &lt;module_name&gt;
&lt;release&gt; &lt;branch_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script starts a new bugfix
branch. This is to be used when
a release has been made and we
need to patch that release.</p>
<p>The script copies the release
called &lt;release&gt; of module
&lt;module_name&gt; into a new branch
&lt;branch_name&gt; and checks it out
into the current directory.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Use module of type AREA, where
AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to branch from an IOC module, in
which case &lt;module_name&gt; is
expected to be either of the
form “Subsystem/Location” e.g.
AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-start-bugfix-branch.py -i GEMTEST/MK V1-0 Version1Branch</p>
<p>This command will create the directory
$SVN_ROOT/gem/branches/ioc/GEMTEST/MK/Version1Branch from
$SVN_ROOT/gem/branches/ioc/GEMTEST/MK/V1-0 and then checks out the
branch into “./Version1Branch”</p>
</div>
<div class="section" id="gem-sync-from-trunk-py">
<h3>gem-sync-from-trunk.py<a class="headerlink" href="#gem-sync-from-trunk-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-sync-from-trunk.py [options]</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script will synchronise a
local working copy of a feature
branch, for a support module or
IOC application, with the latest
version on the trunk. For a
project checked out from trunk
simply run the command “svn
status”.</p>
<p>No changes are made to the
repository as a result of
running this script. The only
changes will be to files in the
local working copy of the
branch. All changes in the local
working copy should be checked
and any conflicts resolved.
These changes then need to be
committed back to the feature
branch.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<blockquote>
<div><p>Having run gem-start-feature-branch.py to create branch “Branch1” we
want to pick up changes made by others to the trunk</p>
<p>cd Branch1</p>
<p>gem-sync-from-trunk.py</p>
<p>To get a listing of any conflicts introduced by the update run the
command</p>
<p>svn status</p>
</div></blockquote>
</div>
<div class="section" id="gem-list-branches-py">
<h3>gem-list-branches.py<a class="headerlink" href="#gem-list-branches-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-list-branches.py [options]
&lt;module_name&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script returns a list of
branches of a named support
module or IOC collection.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>List branches of modules of type
AREA, where AREA is support or
ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to list branches of IOC modules,
in which case &lt;module_name&gt; is
expected to be either of the
form “Subsystem/Location” e.g.
AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="gem-vendor-import-py">
<h3>gem-vendor-import.py<a class="headerlink" href="#gem-vendor-import-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-vendor-import.py [options]
&lt;source&gt; &lt;module&gt; &lt;version&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script imports a support
module or IOC application
provided by a vendor into the
Subversion repository.</p>
<p>The script imports the code from
&lt;source&gt; to a new (vendor)
module in Subversion at
$SVN_ROOT/gem/v
endor/&lt;area&gt;/&lt;module&gt;/&lt;version&gt;.</p>
<p>It also copies the code to the
trunk and checks it out into the
current directory.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Import modules of type AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to import an IOC module, in
which case &lt;module&gt; is expected
to be either of the form
“Subsystem/Location” e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<p>gem-vendor-import.py sources Vendor1 Version1</p>
<p>This command imports the contents of the directory ./sources into
$SVN_ROOT/gem/vendor/support/Vendor1/Current and copies it to
$SVN_ROOT/gem/vendor/support/Vendor1/Version1, as well as
$SVN_ROOT/gem/trunk/support/Vendor1.</p>
</div>
<div class="section" id="gem-vendor-update-py">
<h3>gem-vendor-update.py<a class="headerlink" href="#gem-vendor-update-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-vendor-update.py [options]
&lt;source&gt; &lt;module&gt; &lt;old&gt; &lt;new&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script creates a new
version of a vendor support
module or IOC application by
merging an existing version
label with a new version.</p>
<p>This script updates vendor
&lt;module&gt; from tag &lt;old&gt; to tag
&lt;new&gt; using the code from
&lt;source&gt;.</p>
<p>The updated vendor module is
imported into:
$SVN_ROOT/gem
/vendor/support/&lt;module&gt;/current</p>
<p>which contains a history of all
the releases made by the vendor.
The code is then copied into:</p>
<p>$SVN_ROOT/ge
m/vendor/support/&lt;module&gt;/&lt;new&gt;.</p>
<p>&lt;old&gt; must be the tag used for
the previous import into
“current” i.e. it would have
been tag &lt;new&gt; the last time
this script was run.</p>
<p>The user must perform an
additional step to merge the new
revision onto the trunk as the
trunk may have been edited since
delivery from the vendor.
Instructions are displayed when
the script is run.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Update a module of type AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to update an IOC module, in
which case &lt;module&gt; is expected
to be either of the form
“Subsystem/Location” e.g. AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>Example</p>
<blockquote>
<div><p>gem-vendor-update.py sources Vendor1 Version1 Version2</p>
<p>This command imports the contents of ./sources into
$SVN_ROOT/gem/vendor/support/Vendor1/Version2 and
$SVN_ROOT/gem/vendor/support/Vendor1/Current.</p>
<p>To update the trunk version do the following:</p>
<p>svn checkout $SVN_ROOT/gem/trunk/support/Vendor1</p>
<p>cd Vendor1</p>
<p>svn merge $SVN_ROOT/gem/vendor/support/Vendor1/Version1
$SVN_ROOT/gem/vendor/support/Vendor1/Version2</p>
<p>svn status</p>
<p>Fix any conflicts and commit the changes.</p>
</div></blockquote>
</div>
<div class="section" id="gem-get-vendor-current-py">
<h3>gem-get-vendor-current.py<a class="headerlink" href="#gem-get-vendor-current-py" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gem-get-vendor-current.py
[options] &lt;module&gt;</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>This script is used to determine
the last tag of &lt;module&gt; which
was imported into
$SVN_ROOT/gem/
vendor/support/&lt;module&gt;/current.</p>
<p>This tag should be used as the
input argument &lt;old&gt; to
gem-vendor-update.py.</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>-a AREA –area=AREA</p></td>
<td><p>Get tag for module of type AREA,
where AREA is support or ioc.</p>
<p>The default is support.</p>
</td>
</tr>
<tr class="row-even"><td><p>-i –ioc</p></td>
<td><p>Set the module type to be ioc,
to get the tag for an IOC
module, in which case &lt;module&gt;
is expected to be either of the
form “Subsystem/Location” e.g.
AG/MK.</p></td>
</tr>
<tr class="row-odd"><td><p>-h –help</p></td>
<td><p>Display help for using the
script</p></td>
</tr>
</tbody>
</table>
<p>This script is used to determine the last tag of module which was
imported into</p>
<p>$SVN_ROOT/gem/vendor/support/module/current.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../wiki/wiki-index.html" class="btn btn-neutral float-right" title="Wiki Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pdfs-index.html" class="btn btn-neutral float-left" title="PDF Tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Gemini Controls

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>